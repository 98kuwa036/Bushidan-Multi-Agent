# =============================================================
# 将軍システム v9.3 - Configuration
# =============================================================
# "Universal Multi-LLM Framework" - シンプル・実用性・汎用性
# =============================================================

system:
  name: "Bushidan Multi-Agent System"
  version: "9.3"
  language: "ja"
  philosophy: "シンプル・イズ・ベスト + 実用性第一 + 汎用性の追求"
  subtitle: "Universal Multi-LLM Framework"

# --- v9.3 核心機能 ---
v9_3_core_features:
  four_tier_hybrid:
    enabled: true
    description: "4段ハイブリッド・アーキテクチャ"
    philosophy: "クラウドの知能・速度 + ローカルの物量・コスト0"
    layers:
      shogun: "Claude 3.5 Sonnet - 大局的設計図・難解エラー判断"
      karo: "Gemini 2.0 Flash/Groq - 中間管理・爆速コードレビュー"
      taisho: "Qwen3-Coder-30B-A3B (Local) - 実務実装・MCP駆使"
      ashigaru: "動的選択 - 補助・並列処理"
  
  dspy_optimization:
    enabled: true
    description: "プロンプト最適化層"
    technology: "DSPy（構造化指示コンパイル）"
    effect: "日本語意図→構造化指示への自動変換"
    effectiveness_boost: "30-40%"
    features:
      - "将軍・家老の日本語意図を構造化"
      - "大将が最もミスしにくい指示へ変換"
      - "翻訳レイヤーで日本語の壁を突破"
  
  litellm_middleware:
    enabled: true
    description: "統合ミドルウェア"
    features:
      - "複数API・ローカルOllamaを一元化"
      - "4k以内コンテキスト動的圧縮"
      - "大将の脳を推論のみに集中させる"
    context_limit: 4000
  
  smart_web_search:
    enabled: true
    description: "スマート Web 検索"
    technology: "Tavily + Playwright"
    features:
      - "Tavily で大まかに調査→URL特定"
      - "Playwright で狙い撃ち抽出（1,000-2,000文字）"
      - "Memory MCP に7日間キャッシュ"
    content_reduction: "90%削減"
    free_tier: "Tavily 1,000回/月"

# --- リポジトリ同期 ---
repo:
  local_base: "/home/claude"
  github_remote: ""  # git remote から自動取得
  sync_interval_min: 5

# --- 将軍 (総大将) - Strategic Layer ---
# LLM: Claude 3.5 Sonnet (Pro CLI優先 → API補完)
shogun:
  codename: "Shogun"
  role: "将軍 - 大局的設計図作成・難解エラー最終判断・品質保証"
  cli_model: "sonnet"
  api_model: "claude-sonnet-4-5-20250929"
  cost_per_task_yen: 5
  monthly_usage: 100
  v9_3_features:
    - "DSPy最適化統合"
    - "Memory MCP自動記録"
    - "倫理的判断・セキュリティチェック"

# --- 家老 (参謀) - Tactical Layer ---
# LLM: Gemini 2.0 Flash (メイン) / Groq (サブ)
karo:
  codename: "Karo"
  role: "家老 - 中間管理・検分・タスク分解・爆速コードレビュー"
  main_api:
    provider: "google"
    model: "gemini-2.0-flash"
    cost_per_task_yen: 0.05
    strengths: ["日本語最高級", "速度極めて高速", "コスト極安", "安定性Google保証"]
  sub_api:
    provider: "groq"
    model: "llama-3.3-70b-versatile"
    cost_per_task_yen: 0
    strengths: ["瞬発力", "300-500 tok/s"]
  monthly_usage: 2400
  selection_strategy: "将軍が動的選定（単純生成→Groq、複雑検分→Gemini）"
  v9_3_features:
    - "DSPy指示最適化"
    - "大将への構造化指示生成"
    - "結果統合・日本語コメント追加"

# --- 大将 (実装責任者) - Execution Layer ---
# LLM: Qwen3-Coder-30B-A3B (Local Proxmox)
taisho:
  codename: "Taisho"
  role: "大将 - 実務実装・MCP操作・泥臭い作業"
  url: "http://192.168.1.11:11434"
  model: "qwen3-coder-30b-a3b"
  quantization: "Q4_K_M（推奨）"
  vram_usage_gb: 18
  performance: "24 tok/s（CPU推論でも実用的）"
  moe_active_params: "3.3B（推論時）"
  strengths:
    - "32B級知能を24GB RAMで動作"
    - "コード特化（実装品質高い）"
    - "コスト¥0（ローカル推論）"
    - "無制限コンテキスト（大容量作業）"
  v9_3_features:
    - "DSPy翻訳レイヤー（日本語→構造化指示）"
    - "MCP統合（Filesystem・Git・Memory・Web Search）"
    - "LiteLLM経由4k以内コンテキスト圧縮"
  use_cases:
    - "重い実装（数十ファイル参照）"
    - "100回以上の試行錯誤デバッグ"
    - "無料・大容量コンテキストの活用"

# --- 足軽 × MCP (実行部隊) ---
ashigaru:
  count: 4  # v9.3: Core MCP 4つに簡素化
  max_active: 4
  memory_each_mb: "50-150"
  host: "192.168.1.10"
  selection_algorithm: "dynamic"
  servers:
    - id: 1
      name: "filesystem"
      mcp: "@modelcontextprotocol/server-filesystem"
      role: "ファイル読み書き・検索"
    - id: 2
      name: "git"
      mcp: "@modelcontextprotocol/server-git"
      role: "バージョン管理"
    - id: 3
      name: "memory"
      mcp: "@modelcontextprotocol/server-memory"
      role: "知識保持・Web検索キャッシュ（7日間）"
      storage: "shogun_memory.jsonl"
      features:
        - "重要決定事項記録"
        - "技術選定理由保存"
        - "Web検索結果キャッシュ"
        - "人間可読（JSONL）"
        - "git管理可能"
    - id: 4
      name: "web-search-smart"
      type: "custom"
      role: "スマートWeb検索（Tavily + Playwright）"
      features:
        - "Tavily: URL特定"
        - "Playwright: 狙い撃ち抽出"
        - "Memory MCP統合"

# --- 記憶システム（3層アーキテクチャ）---
memory_system:
  enabled: true
  description: "人間の記憶を模倣した3層構造"
  
  short_term:
    layer: "Slack Thread"
    retention: "Thread存続中（数日）"
    management: "自動"
    usage: "会話文脈維持"
  
  medium_term:
    layer: "Memory MCP（shogun_memory.jsonl）"
    retention: "永続（サイズ管理）"
    management: "将軍が自動記録"
    storage_path: "~/shogun_memory.jsonl"
    content:
      - "重要な決定事項"
      - "技術選定理由"
      - "プロジェクト方針"
      - "Web検索結果（7日間キャッシュ）"
    features:
      - "人間可読（JSONL）"
      - "git管理可能"
      - "高速検索（grep、jq）"
      - "複雑性ゼロ"
  
  long_term:
    layer: "Notion Database"
    retention: "永続"
    management: "手動キュレーション"
    usage: "プロジェクトドキュメント・設計書・振り返り"

# --- Groq (サブ家老) ---
groq:
  api_url: "https://api.groq.com/openai/v1"
  model: "llama-3.3-70b-versatile"
  cost_per_task_yen: 0
  free_tier_requests_per_day: 14400
  speed: "300-500 tok/s"
  rate_limiting:
    rpm_limit: 30
    tpm_limit: 14000
    daily_limit: 14400
    exponential_backoff:
      enabled: true
      initial_delay_ms: 1000
      max_delay_ms: 60000
      jitter: true
      max_retries: 5

# --- Network ---
network:
  controller_host: "0.0.0.0"
  controller_port: 8080

# --- Cost Budget (v9.3) ---
budget:
  monthly_target_yen: 3420  # v9.3: -20%削減
  breakdown:
    pro_subscription_yen: 3000
    claude_api_yen: 140
    gemini_api_yen: 130
    tavily_yen: 0  # 無料枠内
    electricity_yen: 150
  comparison:
    vs_v8_1: "-20% (-¥829)"
    vs_claude_code: "-56%"

# --- Quality Metrics (v9.3 目標) ---
quality:
  total_score: 95-96  # v9.3 目標（実用十分）
  breakdown:
    simple: 90-93
    medium: 95-97
    complex: 95-97
    strategic: 97-99

# --- Performance Metrics (v9.3 目標) ---
performance:
  processing_time_seconds:
    simple: 5   # 家老（Groq）瞬発力
    medium: 15  # 大将実装特化
    complex: 30  # 大将+足軽並列
    strategic: 45  # 将軍主導
  
  vs_v8_1:
    speedup: "3.4x"
    monthly_time_reduction: "-71%"

# --- Deployment Modes ---
modes:
  battalion:
    label: "大隊"
    description: "将軍 + 家老 + 大将 + 足軽 + 全MCP"
    api_enabled: true
    trigger: "@shogun-bot"
    cost_per_month_yen: 3420
  
  company:
    label: "中隊"
    description: "家老 + 大将 + 足軽（Slack経由）"
    api_enabled: true
    cost: "Gemini API分のみ"
    trigger: "@shogun-bot-light"
  
  platoon:
    label: "小隊"
    description: "大将 + 必要な足軽のみ（HA OS経由）"
    api_enabled: false
    cost: 0
    trigger: "HA OS音声"
    response_time_sec: "30-60"

# --- Slack Bots ---
slack:
  bots:
    - name: "shogun-bot"
      role: "将軍"
      mode: "battalion"
    - name: "shogun-bot-light"
      role: "中隊モード専用"
      mode: "company"

# --- HA OS (音声インターフェース) ---
ha_os:
  url: "http://192.168.1.20:8123"
  mode: "platoon"
  whisper: "ローカル音声認識"
  tts: "Piper"

# --- Proxmox LXC (v9.3 簡素化構成) ---
proxmox:
  optimization_version: "v9.3"
  total_memory_gb: 24
  containers:
    ct100:
      name: "honmaru-control"
      memory_mb: 2560
      cores: 2
      ip: "192.168.1.10"
      role: "本陣 - MCP管理, Slack Bot, Memory MCP"
    ct101:
      name: "taisho-qwen3-coder"
      memory_mb: 20480
      cores: 6
      ip: "192.168.1.11"
      role: "大将 - Qwen3-Coder-30B-A3B推論"

# --- 運用黄金律 ---
golden_rules:
  simple_generation:
    rule: "単純な生成は家老（Groq）"
    reason: "瞬発力が必要なコード片はGroqに投げ、待ち時間をゼロに"
  
  heavy_implementation:
    rule: "重い実装は大将（Local）"
    reason: "数十ファイル参照や100回以上の試行錯誤は無料・大容量の大将に"
  
  strategic_design:
    rule: "戦略的設計は将軍（Claude）"
    reason: "アーキテクチャ判断・難解エラーはClaudeの深い洞察力で"

# --- v9.3 Implementation Roadmap ---
implementation:
  phases:
    phase1:
      name: "基盤構築"
      duration_hours: "4-6"
      tasks:
        - "Ollama + Qwen3-Coder-30B-A3B"
        - "LiteLLM Proxy設定"
        - "動作確認"
    
    phase2:
      name: "MCP統合"
      duration_hours: "6-8"
      tasks:
        - "Filesystem MCP"
        - "Git MCP"
        - "Memory MCP"
        - "Smart Web Search MCP"
    
    phase3:
      name: "階層統合"
      duration_hours: "6-8"
      tasks:
        - "将軍層実装"
        - "家老層実装"
        - "大将層実装"
        - "統合テスト"
    
    phase4:
      name: "最適化"
      duration_hours: "4-6"
      tasks:
        - "DSPy統合"
        - "並列化実装"
        - "Slack統合"
        - "ドキュメント整備"
  
  total_implementation_time: "20-28時間"

# --- Expected Outcomes ---
expected_outcomes:
  technical:
    - "品質95-96点（実用十分）"
    - "コスト¥3,420（-20%削減）"
    - "処理速度3.4倍改善"
    - "複雑性80%削減"
  
  philosophical:
    - "シンプル・イズ・ベストの実現"
    - "実用性第一の徹底"
    - "汎用性の確保"
  
  practical:
    - "毎日使える道具"
    - "2.5-3.5日で実装可能"
    - "月1時間の保守で運用可能"
